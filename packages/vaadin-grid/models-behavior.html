<script>
  window.vaadin = window.vaadin || {};
  vaadin.elements = vaadin.elements || {};
  vaadin.elements.grid = vaadin.elements.grid || {};

  vaadin.elements.grid.GridModelsBehaviorImpl = {

    properties: {
      dataSource: {
        type: Function,
        value: function() {
          return function(index, callback) {
            callback(index > this.size - 1 ? null : {});
          };
        }
      },

      size: Number,
    },

    observers: ['_sizeChanged(size)'],

    _sizeChanged: function(size) {
      this.items = {length: size, slice: function() { return []; } };
      // this._virtualCount = size;
    },

    /**
     * Assigns the data models to a given set of items.
     * @param {!Array<number>=} itemSet
     */
    _assignModels: function(itemSet) {
      this._iterateItems(function(pidx, vidx) {
        var el = this._physicalItems[pidx];
        el.childNodes.forEach(function(cell) {
          var inst = cell.instance;
          inst[this.indexAs] = vidx;
          this.dataSource(vidx, function(item) {
            if (item != null) {
              inst[this.as] = item;
              inst.__key__ = this._collection.getKey(item);
              inst[this.selectedAs] = /** @type {!ArraySelectorElement} */ (this.$.selector).isSelected(item);
              // inst.tabIndex = this._focusedIndex === vidx ? 0 : -1;
              this._physicalIndexForKey[inst.__key__] = pidx;
              el.removeAttribute('hidden');
            } else {
              inst.__key__ = null;
              el.setAttribute('hidden', '');
            }
          }.bind(this));
        }, this);
      }, itemSet);
    },
  };

  vaadin.elements.grid.GridModelsBehavior = [
    vaadin.elements.grid.GridModelsBehaviorImpl
  ];

</script>
