<script>
  (function() {
    var rowContainerBehavior = {
      properties: {
        columns: Array,
        frozenColumns: Number,
        _rows: Array
      },

      observers: ['_columnsChanged(columns.*, frozenColumns)', '_rowsChanged(_rows)'],

      _columnsChanged: function(e) {
        if (e.path === 'columns') {
          this._rows = Array.apply(null, Array(this._rowCount(e.value))).map(function(item, index) {
            var row = this._createRow();
            row.rowIndex = index;
            row.frozenColumns = this.frozenColumns;
            row.target = this.domHost.domHost;
            row.columns = e.value;

            return row;
          }.bind(this));
        } else if (e.path.indexOf('columns.#') === 0) {
          this._rows.forEach(function(row) {
            row.notifyPath(e.path, e.value);
          });
        }
      },

      _rowsChanged: function(rows) {
        Polymer.dom(this).innerHTML = '';

        rows.forEach(function(row) {
          Polymer.dom(this).appendChild(row);
        }.bind(this));
      }
    };

    Polymer({
      is: 'vaadin-grid-header',
      extends: 'thead',
      behaviors: [rowContainerBehavior],

      _createRow: function() {
        return document.createElement('tr', 'vaadin-grid-header-row');
      },

      _rowCount: function(columns) {
        return Math.max.apply(Math, columns.map(function(column) {
          return Polymer.dom(column).querySelectorAll('[is="header"]').length;
        }));
      }
    });

    Polymer({
      is: 'vaadin-grid-footer',
      extends: 'tfoot',
      behaviors: [rowContainerBehavior],

      _createRow: function() {
        return document.createElement('tr', 'vaadin-grid-footer-row');
      },

      _rowCount: function(columns) {
        return Math.max.apply(Math, columns.map(function(column) {
          return Polymer.dom(column).querySelectorAll('[is="footer"]').length;
        }));
      }
    });
  })();
</script>
