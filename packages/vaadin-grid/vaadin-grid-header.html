<dom-module id="vaadin-grid-header">
  <script>
    Polymer({
      is: 'vaadin-grid-header',

      extends: 'thead',

      properties: {
        columns: Array,
        frozenColumns: Number,
        _rows: Array
      },

      observers: ['_columnsChanged(columns.*, frozenColumns)', '_rowsChanged(_rows)'],

      _columnsChanged: function(e) {
        if (e.path === 'columns') {
          var rowCount = Math.max.apply(Math, e.value.map(function(column) {
            return Polymer.dom(column).querySelectorAll('[is="header"]').length;
          }));

          this._rows = new Array(rowCount).fill(0).map(function(item, index) {
            var row = document.createElement('tr', 'vaadin-grid-header-row');
            row.headerIndex = index;
            row.frozenColumns = this.frozenColumns;
            row.target = this.domHost.domHost;
            row.columns = e.value;

            return row;
          }.bind(this));
        } else if (e.path.indexOf('columns.#') === 0) {
          this._rows.forEach(function(row) {
            row.notifyPath(e.path, e.value);
          });
        }
      },

      _rowsChanged: function(rows) {
        Polymer.dom(this).innerHTML = '';

        rows.forEach(function(row) {
          Polymer.dom(this).appendChild(row);
        }.bind(this));
      }
    });
  </script>
</dom-module>
