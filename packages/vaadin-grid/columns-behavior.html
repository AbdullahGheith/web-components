<script>
  window.vaadin = window.vaadin || {};
  vaadin.elements = vaadin.elements || {};
  vaadin.elements.grid = vaadin.elements.grid || {};

  vaadin.elements.grid.GridColumnsBehaviorImpl = {
    properties: {
      columns: Array
    },

    observers: [
      '_columnsChanged(columns, _physicalCount)'
    ],

    _columnsChanged: function(columns) {
      this._physicalItems.forEach(function(row) {
        row.innerHTML = '';
        for (var colIndex = 0; colIndex < columns.length; colIndex++) {
          var cell = document.createElement('td', 'vaadin-grid-cell');
          cell.target = this.domHost;
          var column = columns[colIndex];
          cell.template = column.template;
          cell.toggleClass('frozen', colIndex <= 1);
          Polymer.dom(row).appendChild(cell);
        }
      }, this);

      this.$.header.innerHTML = '';
      columns.forEach(function(column, columnIndex) {
        column.headers.forEach(function(header, headerIndex) {
          var headerRow = this.$.header.childNodes[headerIndex];
          if (!headerRow) {
            headerRow = document.createElement('tr');
            Polymer.dom(this.$.header).appendChild(headerRow);
          }
          var cell = document.createElement('th', 'vaadin-grid-header-cell');
          cell.target = this.domHost;
          cell.template = header.template;
          cell.toggleClass('frozen', columnIndex <= 1);
          Polymer.dom(headerRow).appendChild(cell);

        }, this);
      }, this);

      requestAnimationFrame(function() {
        this.$.items.style.paddingTop = this.$.header.clientHeight + 'px';
      }.bind(this));


    }
  };

  vaadin.elements.grid.GridColumnsBehavior = [
    vaadin.elements.grid.GridColumnsBehaviorImpl
  ];

</script>
