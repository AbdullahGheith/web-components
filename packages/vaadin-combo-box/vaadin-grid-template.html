<!--
@element vaadin-grid-template
-->

<link rel='import' href='../polymer/polymer.html'>
<link rel='import' href='../vaadin-components/vaadin-grid/vaadin-grid.html'>

<dom-module id="vaadin-grid-template">
  <template>
    <v-grid id="grid">
      <table>
        <col>
      </table>
    </v-grid>
    <div id="templateWrapper" style="display: none">
      <content>
    </div>
  </template>
</dom-module>

<script>
  Polymer({

    is: "vaadin-grid-template",

    properties: {
      selectedItem: {
        notify: true
      },
      template: {
        type: Object
      },
      filter: {
        type: String,
        observer: "filterChanged"
      }

    },


    ready() {
       this.$.grid.header.hidden = true;

       // Not cool if I have to use bind
       this.$.grid.addEventListener("select", this.onSelection.bind(this));

       this.template = this.$.templateWrapper.querySelector("template");
       if (this.template) {
         this.$.grid.columns[0].renderer = this.renderer.bind(this);
       }

       this.$.grid.data.source = function(req) {
         req.filter = this.filter;
         this.dataSource(req);
       }.bind(this);
     },

     renderer(cell) {
       this.template.item = cell.data;
       var result = this.$.templateWrapper.firstElementChild.cloneNode(true);
       cell.element.innerHTML = "";
       cell.element.appendChild(result);
     },

     filterChanged() {
       this.$.grid.data.clearCache();
     },

     onSelection() {
       var selectedIndex = this.$.grid.selection.selected()[0];
       // Not cool if I have to use bind
       this.$.grid.data.getItem(selectedIndex, function(err, item) {
         this.selectedItem = item;
       }.bind(this));
     },

  }); // End Polymer prototype
</script>
