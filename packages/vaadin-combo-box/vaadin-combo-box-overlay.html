<!--
@element vaadin-combo-box
-->

<link rel='import' href='../polymer/polymer.html'>
<link rel='import' href='../iron-input/iron-input.html'>
<link rel='import' href='vaadin-combo-box-grid.html'>
<link rel='import' href='../iron-dropdown/iron-dropdown.html'>

<dom-module id="vaadin-combo-box-overlay">
  <template>
    <style>
      :host {
        @apply(--layout-vertical);
        width: 100%;
        position: absolute;
        bottom: 0;
        left: 0;
      }

      :host[mobile] iron-dropdown {
        top: 0 !important;
        left: 0 !important;
        width: 100%;
      }

      :host:not([mobile]) #input-layout {
        display: none;
      }

      #input-layout {
        @apply(--layout-horizontal);
        background: #fff;
      }

      #filterinput {
        width: 100%;
      }

      :host:not([mobile]) .dropdown-content {
        width: 10000px;
      }
    </style>
    <iron-dropdown opened={{opened}} focus-target=[[input]] fit-into="[[fitInto]]" vertical-align="top" with-backdrop=[[mobile]] id="dropdown">
      <div class="dropdown-content">
        <div id="input-layout">
          <input id="filterinput" on-keyup="filterItems" is="iron-input" bind-value="[[filter]]">
          <iron-icon on-click="clear" icon="clear"></iron-icon>
        </div>

        <vaadin-combo-box-grid id="grid" data-source=[[items]] selected-item="{{selected}}" filter=[[filter]] cell-templates=[[cellTemplates]]>
        </vaadin-combo-box-grid>
      </div>
      <iron-dropdown>
  </template>
</dom-module>

<script>
  Polymer({

    is: "vaadin-combo-box-overlay",

    filterItems: function() {
      this.filter = this.$.filterinput.value;
    },

    clear: function() {
      if (this.$.filterinput.value) {
        this.filter = "";
        this.$.filterinput.value = "";
        this.$.filterinput.focus();
      } else {
        this.close();
      }
    },

    ready: function() {
      this.$.dropdown.focusTarget = this.$.filterinput;
    },

    open: function() {
      this.filter = "";
      this.$.dropdown.open();
    },

    close: function() {
      this.$.dropdown.close();
    },

    listeners: {
      "grid.selected": "close"
    },

    properties: {
      selected: {
        notify: true
      },
      mobile: {
        reflectToAttribute: true
      }

    }

  });
</script>
