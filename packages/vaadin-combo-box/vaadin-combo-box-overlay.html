<!--
@element vaadin-combo-box
-->

<link rel='import' href='../polymer/polymer.html'>
<link rel='import' href='../iron-overlay-behavior/iron-overlay-behavior.html'>
<link rel='import' href='../iron-input/iron-input.html'>
<link rel='import' href='vaadin-combo-box-grid.html'>

<dom-module id="vaadin-combo-box-overlay">
  <template>
    <style>
      :host {
        @apply(--layout-vertical);
        max-width: none !important;
        width: 100%;
        top: 0 !important;
        overflow: hidden;
        background: #fff;
      }

      #input-layout {
        @apply(--layout-horizontal);
      }

    </style>
    <div id="input-layout">
      <input id="input" on-keyup="filterItems" is="iron-input" bind-value="[[filter]]">
      <iron-icon on-click="clear" icon="clear"></iron-icon>
    </div>

    <vaadin-combo-box-grid id="grid" data-source={{dataSource}} selected-item="{{selected}}" filter=[[filter]]>
      <template is="dom-bind">
        <span>[[item]]</span>
      </template>
    </vaadin-combo-box-grid>
  </template>
</dom-module>

<script>
  Polymer({

    is: "vaadin-combo-box-overlay",

    behaviors: [
      Polymer.IronOverlayBehavior
    ],

    filterItems() {
      this.filter = this.$.input.value;
    },

    clear() {
      if (this.$.input.value) {
        this.filter = "";
        this.$.input.value = "";
        this.$.input.focus();
      } else {
        this.close();
      }
    },

    openAndFocus: function() {
      this.filter = "";
      this.$.input.value = this.selected;
      this.open();

      this.async(function() {
        this.$.input.focus();
        this.$.input.setSelectionRange(0, this.$.input.value.length)
      });
    },

    listeners: {
      "grid.selected": "close"
    },

    properties: {
      selected: {
        notify: true
      },
      withBackdrop: {
        value: true
      }
    }


  });
</script>
