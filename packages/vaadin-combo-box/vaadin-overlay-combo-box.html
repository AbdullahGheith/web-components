<!--
@element vaadin-combo-box
-->

<link rel='import' href='../polymer/polymer.html'>
<link rel='import' href='../iron-overlay-behavior/iron-overlay-behavior.html'>
<link rel='import' href='../iron-input/iron-input.html'>
<link rel='import' href='vaadin-grid-template.html'>

<dom-module id="vaadin-overlay-combo-box">
  <template>
    <style>
      :host {
        @apply(--layout-vertical);
        max-width: none !important;
        width: 100%;
        top: 0 !important;
        overflow: hidden;
        background: #fff;
      }

      #input-layout {
        @apply(--layout-horizontal);
      }

    </style>
    <div id="input-layout">
      <input on-keyup="filterItems" is="iron-input" id="input" bind-value="[[initialValue]]">
      <iron-icon on-click="clear" icon="clear" suffix on-click="showDropdown"></iron-icon>
    </div>

    <vaadin-grid-template data-source={{dataSource}} id="list" selected-item="{{selectedItem}}" items=[[items]] filter=[[filter]]>
      <template is="dom-bind">
        <span>[[item]]</span>
      </template>
    </vaadin-grid-template>
  </template>
</dom-module>

<script>
  Polymer({

    is: "vaadin-overlay-combo-box",

    behaviors: [
      Polymer.IronOverlayBehavior
    ],

    itemSelected: function(newValue) {
      if (newValue !== undefined && newValue !== null) {
        this.selected = this.selectedItem;
        this.close();
      }
      this.selectedItem = undefined;
    },

    filterItems() {
      this.filter = this.$.input.value;
    },

    clear() {
      if (this.$.input.value) {
        this.filter = "";
        this.$.input.value = "";
        this.$.input.focus();
      } else {
        this.close();
      }
    },

    openAndFocus: function() {
      this.filter = "";
      this.$.input.value = this.selected;
      this.open();

      this.async(function() {
        this.$.input.focus();
        this.$.input.setSelectionRange(0, this.$.input.value.length)
      });
    },

    properties: {
      selectedItem: {
        observer: "itemSelected"
      },
      selected: {
        notify: true
      },
      withBackdrop: {
        value: true
      }

    }


  });
</script>
