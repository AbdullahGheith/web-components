<!--
@element vaadin-combo-box
-->

<link rel='import' href='../polymer/polymer.html'>
<link rel='import' href='../iron-overlay-behavior/iron-overlay-behavior.html'>
<link rel='import' href='../iron-input/iron-input.html'>
<link rel='import' href='../iron-list/iron-list.html'>

<dom-module id="vaadin-overlay-combo-box">
  <template>
    <style>
      :host {
        max-width: none !important;
        width: 100%;
        top: 0 !important;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        background: #fff;
      }

      input {
        flex: 1;
        -webkit-appearance: none;
        -webkit-tap-highlight-color: transparent;
        border: none;
        box-sizing: border-box;
        box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.15);
        border-radius: 3px;
        font-family: inherit;
        font-size: inherit;
        height: 34px;
        min-height: 34px;
        outline: none;
        padding: 0 8px;
        -webkit-flex-shrink: 0;
        -moz-flex-shrink: 0;
        flex-shrink: 0;
        -ms-flex-negative: 0;
        border-radius: inherit;
        padding-right: 34px;
        width: 100%;
      }

      iron-list {
        flex: 1;
        max-height: 150px;
      }

      iron-list .combobox-item {
        -webkit-box-align: center;
        -moz-box-align: center;
        box-align: center;
        -webkit-align-items: center;
        -moz-align-items: center;
        -ms-align-items: center;
        -o-align-items: center;
        align-items: center;
        -ms-flex-align: center;
        display: -webkit-box;
        display: -moz-box;
        display: box;
        display: -webkit-flex;
        display: -moz-flex;
        display: -ms-flexbox;
        display: flex;
        cursor: pointer;
        height: 34px;
        padding: 0 8px;
      }
    </style>
    <input on-keyup="filter" is="iron-input" id="input" bind-value="{{initialValue}}">

    <iron-list id="list" selection-enabled selected-item="{{selectedItem}}" items=[[items]] as="item">
      <template>
        <div class="combobox-item">[[item]]</div>
      </template>
    </iron-list>
  </template>
</dom-module>

<script>
  Polymer({

    is: "vaadin-overlay-combo-box",

    behaviors: [
      Polymer.IronOverlayBehavior
    ],

    isSelected: function(item) {
      return this.selected === item ? "selected" : "not2";
    },

    filter: function() {
      this.debounce("filter", function() {
        this.items = this.originalItems.filter(function(item) {
          return item.toLowerCase().indexOf(this.$.input.value.toLowerCase()) != -1;
        }.bind(this));
      }, 100);
    },

    itemSelected: function(newValue) {
      if (newValue !== undefined && newValue !== null) {
        this.selected = this.selectedItem;
        this.close();
      }
      this.selectedItem = undefined;
    },

    openAndFocus: function() {
      this.items = this.originalItems;
      this.open();

      this.async(function() {
        this.$.input.focus();
        this.$.input.setSelectionRange(0, this.$.input.value.length)
      });
    },

    properties: {
      selectedItem: {
        value: undefined,
        observer: "itemSelected"
      },
      selected: {
        notify: true
      },
      withBackdrop: {
        value: true
      },
      originalItems: {
        type: Object,
        value: ["Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua & Deps", "Argentina", "Armenia", "Australia", "Austria", "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Benin",
          "Bhutan", "Bolivia", "Bosnia Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", "Burkina", "Burundi", "Cambodia", "Cameroon", "Canada", "Cape Verde", "Central African Rep", "Chad", "Chile", "China", "Colombia", "Comoros",
          "Congo", "Congo {Democratic Rep}", "Costa Rica", "Croatia", "Cuba", "Cyprus", "Czech Republic", "Denmark", "Djibouti", "Dominica", "Dominican Republic", "East Timor", "Ecuador", "Egypt", "El Salvador", "Equatorial Guinea", "Eritrea",
          "Estonia", "Ethiopia", "Fiji", "Finland", "France", "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana", "Haiti", "Honduras", "Hungary", "Iceland", "India",
          "Indonesia", "Iran", "Iraq", "Ireland {Republic}", "Israel", "Italy", "Ivory Coast", "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Korea North", "Korea South", "Kosovo", "Kuwait", "Kyrgyzstan", "Laos", "Latvia",
          "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", "Luxembourg", "Macedonia", "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", "Mauritius", "Mexico", "Micronesia",
          "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar, {Burma}", "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "Norway", "Oman", "Pakistan", "Palau", "Panama",
          "Papua New Guinea", "Paraguay", "Peru", "Philippines", "Poland", "Portugal", "Qatar", "Romania", "Russian Federation", "Rwanda", "St Kitts & Nevis", "St Lucia", "Saint Vincent & the Grenadines", "Samoa", "San Marino",
          "Sao Tome & Principe", "Saudi Arabia", "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands", "Somalia", "South Africa", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname",
          "Swaziland", "Sweden", "Switzerland", "Syria", "Taiwan", "Tajikistan", "Tanzania", "Thailand", "Togo", "Tonga", "Trinidad & Tobago", "Tunisia", "Turkey", "Turkmenistan", "Tuvalu", "Uganda", "Ukraine", "United Arab Emirates",
          "United Kingdom", "United States", "Uruguay", "Uzbekistan", "Vanuatu", "Vatican City", "Venezuela", "Vietnam", "Yemen", "Zambia", "Zimbabwe"
        ]
      }


    }


  });
</script>
