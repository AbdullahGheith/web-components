<!--
@element vaadin-overlay
-->

<link rel='import' href='../polymer/polymer.html'>
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">

<dom-module id="vaadin-overlay">
  <style>
    :host {
      position: absolute;
      z-index: 100;
      @apply(--shadow-elevation-2dp);
      background: #fff;
      border-radius: 0 0 2px 2px;
    }

    /* TODO: Consider removing the scroll wrapper */
    /* #scroller { */
    /*   max-height: 65vh; */
    /*   overflow: auto; */
    /*   transform: translate3d(0, 0, 0); */
    /* } */
  </style>

  <template>
    <!-- TODO: Consider removing the scroll wrapper -->
    <!-- <div id="scroller" scroller="[[_getScroller()]]"></div> -->
  </template>
</dom-module>

<script>
  Polymer({
    is: 'vaadin-overlay',

    behaviors: [
      Polymer.IronResizableBehavior
    ],

    properties: {
      /**
       * The element to position/align the dropdown by.
       */
      positionTarget: {
        type: Object
      },

      /**
       * Vertical offset for the overlay position.
       */
      verticalOffset: {
        type: Number,
        value: 0
      }
    },

    listeners: {
      'iron-resize': '_setOverlayPosition'
    },

    attached: function() {
      this._setOverlayPosition();
    },

    /* TODO: Consider removing the scroll wrapper */
    // _getScroller: function() {
    //   return this.$.scroller;
    // },

    // If document.body doesn't have position:static, we need to deduct the body margins from
    // the overlay position. Alternatively, the margins could be added directly to top and left properties.
    _setMargins: function() {
      var styles = window.getComputedStyle(document.body);

      this.style.marginTop = styles.position === 'static' ? 0 : '-' + styles.marginTop;
      this.style.marginLeft = styles.position === 'static' ? 0 : '-' + styles.marginLeft;
    },

    _setOverlayPosition: function() {
      var bodyRect = document.body.getBoundingClientRect();
      var target = this.positionTarget;
      var targetRect = target.getBoundingClientRect();

      this.style.top = targetRect.top + (document.body.scrollTop || document.documentElement.scrollTop) +
                       target.clientHeight + this.verticalOffset + 'px';
      this.style.left = targetRect.left + (document.body.scrollLeft || document.documentElement.scrollLeft) + 'px';
      this._setMargins();

      this.style.width = this.positionTarget.clientWidth + 'px';
    }
  });
</script>
