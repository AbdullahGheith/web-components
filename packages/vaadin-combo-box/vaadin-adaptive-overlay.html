<!--
@element vaadin-adaptive-overlay
-->

<link rel='import' href='../polymer/polymer.html'>
<link rel='import' href='../iron-dropdown/iron-dropdown.html'>

<dom-module id="vaadin-adaptive-overlay">
  <style>
    #dropdown[fullscreen],
    #dropdown[fullscreen]::content #contentWrapper,
    #dropdown[fullscreen] .dropdown-content {
      height: 100%;
    }

    :host .dropdown-content {
      width: 100vw;
    }
  </style>

  <template>
    <iron-dropdown id="dropdown" opened={{opened}} fullscreen$=[[_fullScreen]]>
      <div class="dropdown-content">
        <content>
      </div>
    </iron-dropdown>
  </template>
</dom-module>

<script>
  Polymer({
    is: "vaadin-adaptive-overlay",

    properties: {
      /**
       * True if the overlay is open, false otherwise.
       */
      opened: {
        type: Boolean,
        notify: true,
        value: false
      },

      _fullScreen: {
        type: Boolean,
        observer: '_fullScreenChanged',
        value: function() {
          try {
            document.createEvent("TouchEvent");
            return true;
          } catch (e) {
            return false;
          }
        }
      },
    },

    _fullScreenChanged: function() {
      this.$.dropdown.fitInto = this._fullScreen ? document.documentElement : this.parentElement;
      this.$.dropdown.positionTarget = this._fullScreen ? document.documentElement : this;
    },

    _patchIronFitBehavior: function() {
      // Need to monkeypatch _sizeDimension to avoid a bug in iron-fit-behavior
      var sd = this.$.dropdown._sizeDimension.bind(this.$.dropdown);
      this.$.dropdown._sizeDimension = function(rect, positionedBy, start, end, extent) {
        sd(extent === "Width" ? {
          left: 0
        } : rect, positionedBy, start, end, extent);
      };
    },

    ready: function() {
      this._patchIronFitBehavior();
    },

    attached: function() {
      this._fullScreenChanged();
    },

    open: function() {
      this.$.dropdown.open();
    }
  });
</script>
